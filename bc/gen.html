<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="Content-Language" content="ja" />
<meta http-equiv="Content-Style-Type" content="text/css" />
<meta http-equiv="Content-Script-Type" content="text/javascript" />
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="Cache-Control" content="no-cache" />
<title>datagen</title>
</head>

<body>
<div>ちょっとまって</div>
</body>

<script type="text/javascript">
"use strict";
var Data={shinkis:[],busos:[],individuals:[]};
//データ整形ーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーー
var conv=function(row,n){
	var buso = {};

	buso.part=n;
	buso.set=row[0];
	buso.class = row[1];
	buso.name=row[2];
	buso.rarelity=row[3];
	buso.atk=row[4];
	buso.def=row[5];
	buso.spd=row[6];
	buso.lp=row[7];
	buso.bst=row[8];
	buso.passive=row[9];
	buso.effect=row[10];
	buso.biko=row[11];
	return buso;
}

var prepareData=function(data){
	//省略セルデータ補間
	var keys = Object.keys(data);
	for(var i=0;i < keys.length;i++){
		if(keys[i]==="lists"){ continue; }
		var list = data[keys[i]];
		for(var j=1;j<list.length;j++){
			var row = list[j];
			for(var k=0;k<row.length;k++){
				if(row[k]==="" || row[k]==="#N/A"){
					row[k]=list[j-1][k];
				}
			}
		}
		
	}
	//名称リスト
	var lists = data.lists;
	for(var i=0;i<lists[0].length;i++){
		var list=[];
		for(var j=1;j<lists.length;j++){
			if(lists[j][i] ==="")break;
			list.push(lists[j][i]);
		}
		Data[lists[0][i]]=list;
	}

	//神姫
	for(var i=0;i<data.shinki.length;i++){
		var row = data.shinki[i];
		var shinki= {};

		shinki.cd="shinki_"+i;
		shinki.name=row[0];
		shinki.rarelity=row[1];
		shinki.atk=row[2];
		shinki.def=row[3];
		shinki.spd=row[4];
		shinki.lp=row[5];
		shinki.bst=row[6];
		shinki.apts=row.slice(7,7+15);
		shinki.apts.unshift(0);
		shinki.rarelity=0;
		Data.shinkis.push(shinki);
	}
	//アイコン補正
	for(var i=0;i<data.individuals.length;i++){
		var row = data.individuals[i];
		var individual= {};
		individual.name=row[0];
		individual.atk=Number(row[1]);
		individual.def=Number(row[2]);
		individual.spd=Number(row[3]);
		individual.lp=Number(row[4]);
		individual.bst=Number(row[5]);
		Data.individuals.push(individual);
	}
	//武装
	for(var j=1;j<6;j++){
		var part=Data.part_cd[j];
		var part_data= data[part];
		if(!part_data)continue;
		for(var i=0;i<part_data.length;i++){
			var row = part_data[i];
			var buso = conv(row,j);
			buso.cd=part+"_"+i;
			Data.busos.push(buso);

	  		if(j===5){
	  			buso.flying=row[12];
				if(buso.flying !== 1)buso.flying=0;
			}
		}
	}

	//武器カテゴリ
	Data.categories = data.weapon_categories.map(function(e){
	  return {name:e[0],short_name:e[1]};
	});

	//武器
	var part_data= data.weapon;
	for(var i=0;i<part_data.length;i++){
		var row = part_data[i];
		var buso = conv(row,6);
		buso.cd="weapon_"+i;
		buso.passive=-1;
		buso.active=row[9];
		buso.category=row[12];
		buso.range=row[13];
		Data.busos.push(buso);
	}

	//パッシブ
	Data.passives= data.passive.map(function(e){return {name:e[0]};});

	var correctStatus=function(atk,def,spd,lp,bst){
	   values.total.atk += Math.trunc(values.subtotal.atk * 0.01*atk);
	   values.total.def += Math.trunc(values.subtotal.def * 0.01*def);
	   values.total.spd += Math.trunc(values.subtotal.spd * 0.01*spd);
	   values.total.lp  += Math.trunc(values.subtotal.lp  * 0.01*lp);
	   values.total.bst += Math.trunc(values.subtotal.bst * 0.01*bst);
	}
	Data.passives[ 1].func=function(effect){ correctStatus(1+effect,0,0,0,0); }
	Data.passives[ 2].func=function(effect){ correctStatus(0,1+effect,0,0,0); }
	Data.passives[ 3].func=function(effect){ correctStatus(0,0,1+effect,0,0); }
	Data.passives[ 4].func=function(effect){ correctStatus(0,0,0,1+effect,0); }
	Data.passives[ 5].func=function(effect){ correctStatus(0,0,0,0,1+effect); }
	Data.passives[ 6].func=function(effect){
		var a =Math.trunc(effect*0.5)
		correctStatus(a+1,a+1,a,a+1,a+1);
	}

	//アクティブ
	Data.actives = data.active.map(function(e){return {name:e[0]};});

	//レベル増加値
	Data.lv_bonus={};
	var sheet_data = data.lv_bonus;
	for(var i=0;i < sheet_data.length;){
		var bonuses=[];
		var part = sheet_data[i][0];
		for(var j=0;j < 4;j++){
			var bonus={};
			var row = data.lv_bonus[i];
			bonus.atk=row[3];
			bonus.def=row[4];
			bonus.spd=row[5];
			bonus.lp =row[6];
			bonus.bst=row[7];
			bonuses.push(bonus);
			i++;
		}
		Data.lv_bonus[part] = bonuses;
	}

	Data.shinki_rarelity_bonus=[
		{atk:0,def:0,spd:0,lp:0,bst:0}
		,{atk:5,def:5,spd:10,lp:50,bst:20}
		,{atk:10,def:10,spd:20,lp:100,bst:40}
		,{atk:15,def:15,spd:30,lp:150,bst:60}
	];


    let blob = new Blob(["var Data=",JSON.stringify(Data),";"],{type:"text/plan"});
	var a =document.createElement('a');
	a.href=URL.createObjectURL(blob);
	a.innerText="data.js";
	a.download="data.js";
	document.body.appendChild(a);
	var span =document.querySelector('div');
	span.textContent="できた";
	document.body.appendChild(span);
}
</script>
<script type="text/javascript" src="https://script.google.com/macros/s/AKfycbx-WLdGV8_s5s3Cus5xIltvzh76ML8EnPhmP2pX0t4/dev"></script>
</html>


