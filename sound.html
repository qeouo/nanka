<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=Edge"/>
<meta charset="utf-8">
<title>between</title>
</head>
<body >
test
<audio id='a' controls="true">
</audio>
<input type="file" id="files" name="upfile[]" multiple  /><br />
</body>
<script type="text/javascript">
"use strict"
// バイト配列に文字列を書き込む
function writeString(bytes, val, offset) {
    for (var i = 0, l = val.length; i < l; i++) {
        bytes[offset + i] = val.charCodeAt(i);
    }
}

// バイト配列に 32-bit 整数を書き込む
function writeInt32(bytes, val, offset) {
    bytes[offset] = val & 255;
    val >>>= 8;
    bytes[offset + 1] = val & 255;
    val >>>= 8;
    bytes[offset + 2] = val & 255;
    val >>>= 8;
    bytes[offset + 3] = val & 255;
}

// バイト配列に 16-bit 整数を書き込む
function writeInt16(bytes, val, offset) {
    bytes[offset] = val & 255;
    val >>>= 8;
    bytes[offset + 1] = val & 255;
}

// -----------------------------------------------------------------------------

var channel = 1;         // チャンネル数 (1:モノラル or 2:ステレオ)
var srate = 44100; // サンプリングレート
var bitsPerSample = 16;  // サンプルあたりのビット数 (8 or 16)
var blockSize = (bitsPerSample >>>3) * channel ;
var size = srate * blockSize * 2;        // データサイズ (byte)

var offset = 44;         // ヘッダ部分のサイズ


var bytes2 = new Uint8Array(srate * blockSize * 8);
offset=0
// 波形データ書き込み (サイン波)
var i;
var ps=1/srate * 440 * Math.pow(2,1/12) * (Math.PI*2)
var size=bytes2.length;
var imax=size/2
var oto=0;
var drm=[3,5,7,8,10,12,14,15]
var score=[2,2,2,2,2,2,2,2,2,4,0,1,2,2,2,2,2,2]
for (i = 0; i < imax; i ++) {
	if(i%(srate/2)==0){
		ps=1/srate * 440 * Math.pow(2,drm[score[oto]]/12) * (Math.PI*2)
		oto++
	}
	if(i%(srate/2)>srate/8){
	    writeInt16(bytes2,0, offset + i*2);
	}else{
	    writeInt16(bytes2, Math.sin(i*ps)*32767| 0, offset + i*2);
	}
}
// バイト配列を作成
var bytes = new Uint8Array(44);
// ヘッダ書き込み
writeString(bytes, 'RIFF', 0);                 // RIFF ヘッダ
writeInt32(bytes, 44 + size - 8, 4);       // ファイルサイズ - 8
writeString(bytes, 'WAVE', 8);                 // WAVE ヘッダ
writeString(bytes, 'fmt ', 12);                // fmt チャンク
writeInt32(bytes, 16, 16);                     // fmt チャンクのバイト数
writeInt16(bytes, 1, 20);                      // フォーマットID
writeInt16(bytes, channel, 22);                // チャンネル数
writeInt32(bytes, srate , 24);            // サンプリングレート
writeInt32(bytes, srate * blockSize, 28); // データ速度
writeInt16(bytes, blockSize , 32); // ブロックサイズ
writeInt16(bytes, bitsPerSample, 34);          // サンプルあたりのビット数
writeString(bytes, 'data', 36);                // data チャンク
writeInt32(bytes, size, 40);                   // 波形データのバイト数

var blob=new Blob([bytes,bytes2]);
var url=window.URL.createObjectURL(blob);

document.getElementById('a').src=url;


</script>
