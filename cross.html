<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>between</title>
</head>
<body>
<canvas id="c1" width="200" height="200" style="border:solid 1px black;">
</canvas>
<canvas id="c2" width="200" height="200" style="border:solid 1px black;">
</canvas><br>
<script type="text/javascript">
"use strict"
var ctx,ctx2,ctx3;
var WIDTH,HEIGHT;

var Vec3=(function(){
	var Vec3=function(){this[0]=0;this[1]=0;this[2]=0;};
    Vec3.set=function(a,x,y,z){a[0]=x;a[1]=y;a[2]=z}
    Vec3.cpy=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2]}
    Vec3.add=function(a,b,c){a[0]=b[0]+c[0];a[1]=b[1]+c[1];a[2]=b[2]+c[2]}
    Vec3.sub=function(a,b,c){a[0]=b[0]-c[0];a[1]=b[1]-c[1];a[2]=b[2]-c[2]}
    Vec3.mul=function(a,b,c){a[0]=b[0]*c;a[1]=b[1]*c;a[2]=b[2]*c}
    Vec3.sca=function(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2])}
    Vec3.nrm=function(a,b){var det=1/Vec3.sca(b);Vec3.mul(a,b,det)}
    Vec3.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2];}
	return Vec3
})()
var Mat43=(function(){
	var x,y,z;
	var v = new Array(16)
	var Mat43 = function(){this[0]=1;this[1]=0;this[2]=0;this[3]=0;this[4]=0;this[5]=1;this[6]=0;this[7]=0;
	this[8]=0;this[9]=0;this[10]=1;this[11]=0;this[12]=0;this[13]=0;this[14]=0;this[15]=1;};
	Mat43.set = function(m,a0,a1,a2,a3,a4,a5,a6,a7,a8,a9,a10,a11,a12,a13,a14,a15){
		m[0]=a0;m[1]=a1;m[2]=a2;m[3]=a3;m[4]=a4;m[5]=a5;m[6]=a6;m[7]=a7;
	m[8]=a8;m[9]=a9;m[10]=a10;m[11]=a11;m[12]=a12;m[13]=a13;m[14]=a14;m[15]=a15;};
	Mat43.dotVec=function(a,b,c){
		x=b[0]*c[0]+b[4]*c[1]+b[8]*c[2]+b[12];
		y=b[1]*c[0]+b[5]*c[1]+b[9]*c[2]+b[13];
		z=b[2]*c[0]+b[6]*c[1]+b[10]*c[2] +b[14];
		a[0]=x;a[1]=y;a[2]=z;
	};
	Mat43.dot=function(a,b,c){
		var i,j;
		for(i=0;i<16;i+=4){
			for(j=4;j--;){
				v[j+i]=b[j]*c[i] +b[4+j]*c[i+1] +b[8+j]*c[i+2]+b[12+j]*c[i+3];
			}
		}
		for(i=16;i--;)a[i]=v[i]
	};
	return Mat43;
})()
var i,j;
var verticesOrg=[[1,1,-1],[-1,1,-1],[-1,-1,-1],[1,-1,-1],[1,1,1],[-1,1,1],[-1,-1,1],[1,-1,1]];
var edges=[[0,1,0,2],[1,2,0,3],[2,3,0,4],[3,0,0,5],[4,5,1,2],[5,6,1,3],[6,7,1,4],[7,4,1,5],[0,4,5,2],[1,5,2,3],[2,6,3,4],[3,7,4,5]];
var faces=[[0,1,2,3],[7,6,5,4],[0,4,5,1],[1,5,6,2],[2,6,7,3],[3,7,4,0]];
var facesides=new Array(faces.length);
var verticesbuf=[];
var vbindex=0;
for(i=verticesOrg.length;i--;){verticesbuf.push(new Vec3());}

var veca=new Vec3()
var vecb=new Vec3()
var mat=new Mat43()
var frame = 0;
document.body.onload=function(e){
    var canvas=  document.getElementById('c1')
    WIDTH=canvas.width;
    HEIGHT=canvas.height;
	ctx = canvas.getContext('2d');
	ctx.fillStyle="#FFFF00";
	ctx.strokeStyle="#000000";
    ctx2=  document.getElementById('c2').getContext('2d')
	setTimeout(mainloop,33);
}

var x=2,y=1,z=2;
var vx=0.1,vy=0.1,vz=0.1;

var mainloop=function(e){
	var i,vertex,retio;
	var vertices;
	frame++;
	a=Math.PI*frame*0.005;
	x+=vx
	y+=vy
	z+=vz
	if(x>5)vx=-0.1
	if(x<-5)vx=0.1
	if(y>5)vy=-0.1
	if(y<-5)vy=0.1
	if(z>5)vz=-0.1
	if(z<0)vz=0.1
//		x=0;y=0;z=0;
	for(i=verticesOrg.length;i--;){
		vertex=verticesbuf[i];

		Vec3.cpy(vertex,verticesOrg[i]);

		Mat43.set(transMat,1,0,0,0,0,1,0,0,0,0,1,0,x+0.2,y,z,1);
		Mat43.set(mat,Math.cos(a),0,Math.sin(a),0
			,0,1,0,0
			,Math.sin(a),0,-Math.cos(a),0
			,0,0,0,1);
		Mat43.dot(transMat,transMat,mat);
		Mat43.set(mat,1,0,0,0
			,0,Math.cos(a),Math.sin(a),0
			,0,Math.sin(a),-Math.cos(a),0
			,0,0,0,1);
		Mat43.dot(transMat,transMat,mat);

		Mat43.dotVec(vertex,transMat,vertex);
		
		translate(vertex);
	}	

	draw(ctx)
	for(i=verticesOrg.length;i--;){
		vertex=verticesbuf[i];

		Vec3.cpy(vertex,verticesOrg[i]);

		Mat43.set(transMat,1,0,0,0,0,1,0,0,0,0,1,0,x-0.2,y,z,1);
		Mat43.set(mat,Math.cos(a),0,Math.sin(a),0
			,0,1,0,0
			,Math.sin(a),0,-Math.cos(a),0
			,0,0,0,1);
		Mat43.dot(transMat,transMat,mat);
		Mat43.set(mat,1,0,0,0
			,0,Math.cos(a),Math.sin(a),0
			,0,Math.sin(a),-Math.cos(a),0
			,0,0,0,1);
		Mat43.dot(transMat,transMat,mat);

		Mat43.dotVec(vertex,transMat,vertex);
		
		translate(vertex);
	}	
	draw(ctx2)
	setTimeout(mainloop,33);
}
var draw = function(ctx){
	var face,edge,vertex;
	var vertices=verticesbuf

	ctx.fillStyle="#FFFFFF"
	ctx.fillRect(0,0,WIDTH,HEIGHT);
	ctx.fillStyle="#FFFFFF"
	for(i=faces.length;i--;){
		face=faces[i]

		Vec3.sub(veca,vertices[face[1]],vertices[face[0]])
		Vec3.sub(vecb,vertices[face[2]],vertices[face[0]])
		if(veca[0]*vecb[1]-veca[1]*vecb[0]<0){
			facesides[i]=false;
			continue;
		}
			facesides[i]=true;

		ctx.beginPath();
		vertex=vertices[face[0]];
		ctx.moveTo(vertex[0],vertex[1]);
		vertex=vertices[face[1]];
		ctx.lineTo(vertex[0],vertex[1]);
		vertex=vertices[face[2]];
		ctx.lineTo(vertex[0],vertex[1]);
		vertex=vertices[face[3]];
		ctx.lineTo(vertex[0],vertex[1]);
		ctx.closePath();
		ctx.fill();
	}
	for(i=edges.length;i--;){
		edge=edges[i]
		if(!facesides[edge[2]] && !facesides[edge[3]])continue;
		//if(facesides[edge[2]] == facesides[edge[3]])continue;
		ctx.beginPath();
		vertex=vertices[edge[0]];
		ctx.moveTo(vertex[0],vertex[1]);
		vertex=vertices[edge[1]];
		ctx.lineTo(vertex[0],vertex[1]);
		ctx.closePath();
		ctx.stroke();
	}
}
var pos = new Vec3();
var a=0;
var transMat=new Mat43();
var translate=function(vertex){

	vertex[0]=vertex[0]*200/(vertex[2]+10)+(WIDTH>>1);
	vertex[1]=vertex[1]*200/(vertex[2]+10)+(HEIGHT>>1);
}
</script>

</body>
</html>
