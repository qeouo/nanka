<html>
	<head>
<script type="text/javascript" src="lib/inherits.js"></script>
		<script type="text/javascript" src="lib/vector.js"></script>
	</head>
	<body>
		<canvas id="c" width="512" height="512"></canvas>
<script type="text/javascript">
var canvas=document.getElementById("c");
var ctx = canvas.getContext("2d");

var points=[];
for(var pi=0;pi<14;pi++){
	points.push([Math.random()*500,Math.random()*500]);
//	points.push([pi*50,(pi-2)*(pi-2)*50+50]);
}


var result=[];
for(var i=0;i<4;i++){
	result.push(new Vec2());
}

 
        
var p = points;
var q0=new Vec2(),q1=new Vec2();
var calc2=function(res,n,p){
	if(n<0 || n>=p.length-1){
		return;
	}
	var i = n;
	if(i>0 ){
			//Vec2.sub(q[i],p[i+1],p[i-1]);
			//var l = Vec2.scalar(q[i]);
			//var aaa=new Vec2();
			//var bbb=new Vec2();
			//Vec2.sub(aaa,p[i],p[i-1]);
			//Vec2.norm(aaa);
			//Vec2.sub(bbb,p[i+1],p[i]);
			//Vec2.norm(bbb);
			//Vec2.add(q[i],aaa,bbb);
			//Vec2.norm(q[i]);
			//Vec2.mul(q[i],q[i],l*0.5);
			Vec2.sub(q0,p[i+1],p[i-1]);
			Vec2.mul(q0,q0,0.5);
	}else if(i==0){
//		Vec2.sub(q[i],p[i+1],p[i]);
//		var q2=new Vec2();
//		Vec2.sub(q2,p[i+2],p[i]);
//		Vec2.mul(q2,q2,0.5);
//		
//		var x=q[i][1];
//		q[i][1]=q[i][0];
//		q[i][0]=-x;
//		Vec2.norm(q[i]);
//		Vec2.madd(q[i],q2,q[i],Vec2.dot(q[i],q2)*-2);
		Vec2.sub(q0,p[i+1],p[i]);
	}
	if(i+2>=p.length){
		Vec2.sub(q1,p[i+1],p[i]);
	}else{
		Vec2.sub(q1,p[i+2],p[i]);
		Vec2.mul(q1,q1,0.5);
	}

	Vec2.copy(res[3],points[i]);

	Vec2.copy(res[2],q0);
    
	Vec2.madd(res[0],q1,p[i+1],-2);
	Vec2.add(res[0],res[0],q0);
	Vec2.madd(res[0],res[0],p[i],2);

	Vec2.sub(res[1],p[i+1],res[0]);
	Vec2.sub(res[1],res[1],q0);
	Vec2.sub(res[1],res[1],p[i]);
}
//for(i=0; i<num-1; i++) {
//	calc2(result,i,points);
//}
	

var ret=[0,0];
var calc=function(t){
    var j = Math.min(points.length-2,Math.max(0,Math.floor(t)));
    var dt = t - j;

	calc2(result,j,points);

	Vec3.mul (ret,    result[0],dt*dt*dt);
	Vec3.madd(ret,ret,result[1],dt*dt);
	Vec3.madd(ret,ret,result[2],dt);
	Vec3.add (ret,ret,result[3]);
      
      return ret;
}

ctx.strokeStyle = "red";
ctx.lineWidth= 3;

	var point = points[0];	
	ctx.beginPath();
  ctx.moveTo(point[0],point[1]);
for(var pi=0;pi<points.length;pi+=0.05){
  var point =calc(pi);
  
	ctx.lineTo(point[0],point[1]);
  }
	ctx.stroke();
  

ctx.lineWidth= 1;
ctx.strokeStyle = "black";
ctx.beginPath();
ctx.moveTo(points[0][0],points[0][1]);
for(var pi=1;pi<points.length;pi++){
  var point = points[pi];
ctx.lineTo(point[0],point[1]);
  }
	ctx.stroke();

for(var pi=0;pi<points.length;pi++){
	var point = points[pi];
	ctx.fillRect(point[0]-2,point[1]-2,4,4);
}
	</script>
	</body>
