<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="Content-Language" content="ja" />
<meta http-equiv="Content-Style-Type" content="text/css" />
<meta http-equiv="Content-Script-Type" content="text/javascript" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

</head>

<script type="text/javascript" src="../lib/vector.js"></script>
<script type="text/javascript" src="../lib/geono.js"></script>
<script type="text/javascript" src="../lib/util.js"></script>
<script type="text/javascript" src="../lib/rastono.js"></script>
<script type="text/javascript" src="../lib/rastc2d.js"></script>
<script type="text/javascript" src="../lib/ono3d.js"></script>
<script type="text/javascript" src="../lib/onophy.js"></script>
<script type="text/javascript" src="../lib/o3o.js"></script>
<script type="text/javascript" src="../lib/objman.js"></script>
<script type="text/javascript" src="../lib/rastgl.js"></script>
<script type="text/javascript" src="../lib/slider.js"></script>
<script type="text/javascript" src="../lib/colorpicker.js"></script>
<style type="text/css">
html,body { height:100%;margin:0; }
</style>
<script type="text/javascript">
var pickerflg=false;
	var onl=function(){
		if(globalParam.physics){
			globalParam.physics=false;
			checkbox=document.getElementById("chkPhy");
			checkbox.checked=true;
		}
<<<<<<< HEAD
		Util.fireEvent(obj,"change")
		
	}


	document.getElementById("console").style.display="inline"
}

var changeFunc = function(e){
	var obj= this;
	var paramname="";
	for(var i = control_ids.length;i--;){
		if(obj == ctl[control_ids[i][0]]){
			if(obj.nodeName == "INPUT"){
				switch(obj.type){
				case "checkbox":
				   value = obj.checked
				   break;
				case "text":
				case "range":
					value = obj.value;
					if(isNaN(value)){
						value=0
					}else{
						value=parseFloat(value)
					}
					if(value<0)value=0
					if(value>1)value=1
					break;
				}
			}else if(obj.nodeName=="SELECT"){
				value = obj.value;
			}
			global_param[control_ids[i][1]] = value;

			var mat = O3o.defaultMaterial;
			mat.r=global_param.r;
			mat.g=global_param.g;
			mat.b=global_param.b;
			mat.a=global_param.a;
			mat.mrr=global_param.mrr;
			break;
		}
	}
}
var onloadfunc = function(e){
	global_param.outline=0
	global_param.smoothing=0
	global_param.model=""
	global_param.drawmethod=9
	global_param.smoothing=0
	global_param.phongshading=1
	global_param.depthtest=1
	global_param.perscollect=1
	global_param.usetexture=1
	global_param.wireframe=0
	global_param.outline=0
	global_param.r=0.8
	global_param.g=0.8
	global_param.b=0.8
	global_param.a=1
	global_param.mrr=0
	global_param.custommat=0
	global_param.menu=1
	global_param.files=null
	global_param.no=""
	global_param.caption=""
	global_param.scene=0
	global_param.fps=30
	
	var createRng = function(id){
		var div=document.createElement("DIV");
		div.style.width="200px";


		var lbl= document.createElement('label');
		lbl.innerHTML=id;
		div.appendChild(lbl);
		var output= document.createElement('input');
		output.setAttribute("type","text");
		output.id="txt_" + id;
		output.style.width="32px";
		output.style.margin="0px 8px";
		output.value=1;
		div.appendChild(output);

		var slider=document.createElement('div');
		slider.setAttribute("class","js-slider");
		div.appendChild(slider);

		var div2=document.createElement('div');
		slider.appendChild(div2);

		var input=document.createElement('input');
		input.setAttribute("type","button");
		slider.appendChild(input);

		var root = document.documentElement;
		var dragging = false;
		var value = output.value;
		var width = input.clientWidth / 2;

		var set_value = function (){
			var max=slider.clientWidth;
			var w = input.clientWidth;
			if(w==0)w=15;
			if(max==0)max=100;
		  input.style.left = (value*max - w/2) + 'px';
		  output.value = value;
		};

		output.onchange = function(evt){
			value = evt.target.value;
			set_value();
		}
		input.onmousedown = function(evt){
		  dragging = true;
		  return false;
		};
		var drugend =function(evt){
		  if (dragging) {
			dragging = false;
			output.value = value;
		  }
		};
		var drug=function(evt){
		  if(dragging){
			if(!evt){
			  evt = window.event;
			}
			var left = evt.clientX;
			var rect = slider.getBoundingClientRect();
			value = Math.round(left - rect.left - width);
			if (value < 0) {
			  value = 0;
			} else if (value > slider.clientWidth) {
			  value = slider.clientWidth;
			}
			value/=slider.clientWidth;
			set_value();
			Util.fireEvent(output,"change")

			return false;
		}};
		
		document.addEventListener("mouseup",drugend,false);
		document.addEventListener("mousemove",drug,false);

		slider.onclick = function(evt){
		  dragging = true;
		  drug(evt);
		  drugend();
		};
		return div;
	};

	var createChkCtl=function(id){
		var nobr=document.createElement("SPAN");
		var chk=document.createElement("INPUT");
		var lbl=document.createElement("LABEL");
		chk.id="chk_"+id;
		chk.type="checkbox";
		chk.addEventListener('change', changeFunc, false);
		//chk.setAttribute("onchange",changeFunc); 
		lbl.setAttribute("for",chk.id);
		lbl.innerHTML=id;
		lbl.id="lbl_"+id
		nobr.id="nobr_"+id;
		nobr.style.whiteSpace="nowrap";
		nobr.appendChild(chk);
		nobr.appendChild(lbl);
		document.getElementById("area_chk").appendChild(nobr);
		document.getElementById("area_chk").innerHTML+="\n";
	}

	for(var i=chks.length;i--;){
		createChkCtl(chks[i]);
	}	
	field=document.getElementById("area_chk");
	field.appendChild(createRng("smoothing"));
	var field=document.getElementById("fs_custom");
	field.appendChild(createRng("r"));
	field.appendChild(createRng("g"));
	field.appendChild(createRng("b"));
	field.appendChild(createRng("a"));
	field.appendChild(createRng("mrr"));

	for(var i=0,c;c=control_ids[i];i++){ ctl[c[0]]=document.getElementById(c[0]) }

	document.getElementById("nobr_depthtest").style.display="none";
	document.getElementById("nobr_perscollect").style.display="none";
	document.getElementById("nobr_texture").style.display="none";
	document.getElementById("nobr_phongshading").style.display="none";
	//document.getElementById("nobr_outline").style.display="none";
	document.getElementById("nobr_wireframe").style.display="none";

	var url=location.search.substring(1,location.search.length)
	if(url.length==0){
		url="model=raara.o3o&drawmethod=3&smoothing=1&outline=1";
	}
	
	var args=url.split("&")

	for(i=args.length;i--;){
		var arg=args[i].split("=")
		if(arg.length >1){
			if(!isNaN(arg[1]) && arg[1]!=""){
				global_param[arg[0]] = +arg[1]
			}else{
				global_param[arg[0]] = arg[1]
			}
=======
		if(globalParam.stereomode==-1){
			checkbox=document.getElementById("parallel");
>>>>>>> master
		}else{
			checkbox=document.getElementById("cross");
		}
		checkbox.checked=1;

		document.getElementById("txtSmoothing").value=globalParam.smoothing;
		document.getElementById("txtOutlineWidth").value=globalParam.outlineWidth;
		document.getElementById("outlineColor").value=globalParam.outlineColor;
		document.getElementById("lightcol1").value=globalParam.lightcol1;
		document.getElementById("lightcol2").value=globalParam.lightcol2;
		document.getElementById("txtlightThreshold1").value=globalParam.lightThreshold1;
		document.getElementById("txtlightThreshold2").value=globalParam.lightThreshold2;
		document.getElementById("txtStereo").value=globalParam.stereoscope;

		Util.fireEvent(document.getElementById("chkPhy"),"change");
		Util.fireEvent(document.getElementById("txtSmoothing"),"change");
		Util.fireEvent(document.getElementById("txtOutlineWidth"),"change");
		Util.fireEvent(document.getElementById("outlineColor"),"change");
		Util.fireEvent(document.getElementById("txtStereo"),"change");
		Util.fireEvent(document.getElementById("lightcol1"),"change");
		Util.fireEvent(document.getElementById("lightcol2"),"change");
		Util.fireEvent(document.getElementById("txtlightThreshold1"),"change");
		Util.fireEvent(document.getElementById("txtlightThreshold2"),"change");
	}
var aaa=function(hex){
	var a=new Vec3();
	Util.hex2rgb(globalParam.lightColor,hex);
}
</script>
<<<<<<< HEAD
<body style="font-size:small;" onLoad="onloadfunc(event)">
	
	<div id="console" class="cons" style="min-width:200px;visibility:hidden;">

		<div><pre id="status_a">-</pre></div>
		<span id="sp_scene">scene</span><select type="select" id="cmb_scene" onchange="sb(event)" >
		</select></nobr>
		<pre id="status_b">-</pre>

		<div id="status_c" style="width:0px;">
			<nobr>drawmethod
			<select id="cmb_drawmethod">
			<option value="0">clip+fillRect</option>
			<option value="1">clip+drawImage</option>
			<option value="2">fill</option>
			<option value="3" id="opt3">WebGL</option>
			<option value="9">putImageData</option>
			</select></nobr>
			<div id="area_chk">
			</div>
=======
>>>>>>> master

<body onload="onl();" style="height:100%;">
<div style="width:100%;height:100%;">
<span id="cons"></span>

<pre>
＜説明が入る＞
</pre>
<div  id="control" style="float:left;" >
<div style="float:left;margin:10px;"> 
法線補間<input class="slider" id="Smoothing" onchange="globalParam.smoothing=parseFloat(this.value)"/><br />
光源色1<input class="colorpicker" id="lightcol1" onchange="globalParam.lightcol1=this.value"/><br />
光源色2<input class="colorpicker" id="lightcol2"  onchange="globalParam.lightcol2=this.value"/><br />
セル塗り閾値1<input class="slider" id="lightThreshold1"  onchange="globalParam.lightThreshold1=parseFloat(this.value)"/><br />
セル塗り閾値2<input class="slider" id="lightThreshold2" onchange="globalParam.lightThreshold2=parseFloat(this.value)"/><br />
</div>
<div style="float:left;">
<label><input type="checkbox" id="chkPhy" onchange="Test3d.setPhysics(this.checked);"/>物理シミュ</label><br />
輪郭線太さ<input class="slider" id="OutlineWidth" max="4" onchange="globalParam.outlineWidth=parseFloat(this.value)"/><br />
輪郭線色<input class="colorpicker" id="outlineColor"  onchange="globalParam.outlineColor=this.value"/><br />
立体度<input class="slider" id="Stereo" max="2" onchange="globalParam.stereoscope=parseFloat(this.value)"/><br />
<label><input type="radio" id="cross" name="q1" value="1" onchange="globalParam.stereomode=parseFloat(this.value)"> 交差法</label>
<label><input type="radio" id="parallel" name="q1" value="-1" onchange="globalParam.stereomode=parseFloat(this.value)"> 平行法</label>
</div>
</div>
<div style="clear:both;left:0;right:0;margin:0 auto;width:720px;height:720px;">
<script type="text/javascript" src="./test3d.js"> </script>
</div>
</div>
</body>
</html>

