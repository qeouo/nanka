<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="Content-Language" content="ja" />
<meta http-equiv="Content-Style-Type" content="text/css" />
<meta http-equiv="Content-Script-Type" content="text/javascript" />
<!-- meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" /-->


<script type="text/javascript" src="../lib/vector.js"></script>
<script type="text/javascript" src="../lib/geono.js"></script>
<script type="text/javascript" src="../lib/util.js"></script>
<script type="text/javascript" src="../lib/rastono.js"></script>
<script type="text/javascript" src="../lib/rastc2d.js"></script>
<script type="text/javascript" src="../lib/ono3d.js"></script>
<script type="text/javascript" src="../lib/onophy.js"></script>
<script type="text/javascript" src="../lib/o3o.js"></script>
<script type="text/javascript" src="../lib/objman.js"></script>
<script type="text/javascript" src="../lib/rastgl.js"></script>
<script type="text/javascript" src="../lib/slider.js"></script>
<script type="text/javascript" src="../lib/colorpicker.js"></script>
<style type="text/css">
html,body { height:100%;margin:0; }
</style>
<script type="text/javascript">
var handleFileSelect = function(evt) {
    evt.stopPropagation();
    evt.preventDefault();
    var files
	
	if(evt.dataTransfer){
    	files = evt.dataTransfer.files
	}else{
		files = evt.target.files
	}
//	if(files.length>3){
//		alert("ファイル数が多いです。合計3ファイルまでにしてください。")
//		return
//	}
	var allsize=0
//    for (var i = 0, f; f = files[i]; i++) {
//		allsize+=f.size
//	}
//	if(allsize>10000000){
//		alert("ファイルサイズが大きいです。合計10MBくらいにしてください。")
//		return
//	}
	globalParam.files=files
	var str=""
    for (var i = 0, f; f = files[i]; i++) {
		allsize+=f.size
		if(f.type.indexOf("image")==0){
//			
//			var reader = new FileReader()
//			var name =f.name
//				
//			reader.onload =  function(e){
//				var buf=e.target.result
//				var image = new Image()
//				image.onload=function(e){
//					if(image.width>256 || image.width>256){
//						alert("画像の縦横のサイズが256を超えています:"+name)
//					}
//				}
//				image.src=buf
//			}
//			reader.readAsDataURL(f)
		}else{
			Test3d.loadModel(f);
		}
	}
	Test3d.start();
}
var pickerflg=false;
	var onl=function(){
		if(globalParam.physics){
			globalParam.physics=false;
			checkbox=document.getElementById("chkPhy");
			checkbox.checked=true;
		}
		if(globalParam.stereomode==-1){
			checkbox=document.getElementById("parallel");
		}else if(globalParam.stereomode==1){
			checkbox=document.getElementById("cross");
		}else{
			checkbox=document.getElementById("notstereo");
		}
		checkbox.checked=1;
		if(globalParam.shadow){
			document.getElementById("shadow").checked=true;
		}
			

		document.getElementById("txtSmoothing").value=globalParam.smoothing;
		document.getElementById("txtOutlineWidth").value=globalParam.outlineWidth;
		document.getElementById("outlineColor").value=globalParam.outlineColor;
		document.getElementById("lightcol1").value=globalParam.lightcol1;
		document.getElementById("lightcol2").value=globalParam.lightcol2;
		document.getElementById("txtlightThreshold1").value=globalParam.lightThreshold1;
		document.getElementById("txtlightThreshold2").value=globalParam.lightThreshold2;
		document.getElementById("txtStereo").value=globalParam.stereoscope;
		document.getElementById("scene").value=globalParam.scene;
		document.getElementById("customColor").value=globalParam.customColor;
		document.getElementById("txtcustomReflection").value=globalParam.customReflection;
		document.getElementById("customReflectionColor").value=globalParam.customReflectionColor;
		document.getElementById("txtcustomRoughness").value=globalParam.customRoughness;
		document.getElementById("txtfrenel").value=globalParam.frenel;

		Util.fireEvent(document.getElementById("chkPhy"),"change");
		Util.fireEvent(document.getElementById("txtSmoothing"),"change");
		Util.fireEvent(document.getElementById("txtOutlineWidth"),"change");
		Util.fireEvent(document.getElementById("outlineColor"),"change");
		Util.fireEvent(document.getElementById("txtStereo"),"change");
		Util.fireEvent(document.getElementById("lightcol1"),"change");
		Util.fireEvent(document.getElementById("lightcol2"),"change");
		Util.fireEvent(document.getElementById("txtlightThreshold1"),"change");
		Util.fireEvent(document.getElementById("txtlightThreshold2"),"change");
		Util.fireEvent(document.getElementById("scene"),"change");
		Util.fireEvent(document.getElementById("shadow"),"change");
		Util.fireEvent(document.getElementById("customColor"),"change");
		Util.fireEvent(document.getElementById("txtcustomReflection"),"change");
		Util.fireEvent(document.getElementById("customReflectionColor"),"change");
		Util.fireEvent(document.getElementById("txtcustomRoughness"),"change");
		Util.fireEvent(document.getElementById("txtfrenel"),"change");

		var userAgent = window.navigator.userAgent.toLowerCase();
		if (navigator.platform.indexOf("Win") != -1) {
			globalParam.windows=true;
		}else{
			globalParam.windows=false;
		}

		document.getElementById('files').addEventListener('change', handleFileSelect, false);
		Test3d.start();
	}

</script>

</head>
<body onload="onl();" style="height:100%;">
<input type="file" id="files" name="upfile[]" multiple  style="display:none;" /><br />
<span id="cons"></span>

<pre>
＜説明が入る＞
</pre>
<div  id="control" style="float:left;" >
<div style="float:left;margin:10px;"> 
法線補間<input class="slider" id="Smoothing" onchange="globalParam.smoothing=parseFloat(this.value)"/><br />
光源色1<input class="colorpicker" id="lightcol1" onchange="globalParam.lightcol1=this.value"/><br />
光源色2<input class="colorpicker" id="lightcol2"  onchange="globalParam.lightcol2=this.value"/><br />
セル塗り閾値1<input class="slider" id="lightThreshold1"  onchange="globalParam.lightThreshold1=parseFloat(this.value)"/><br />
セル塗り閾値2<input class="slider" id="lightThreshold2" onchange="globalParam.lightThreshold2=parseFloat(this.value)"/><br />
</div>
<div style="float:left;">
<label><input type="checkbox" id="chkPhy" onchange="globalParam.physics=(this.checked);"/>物理シミュ</label><br />
輪郭線太さ<input class="slider" id="OutlineWidth" max="4" onchange="globalParam.outlineWidth=parseFloat(this.value)"/><br />
輪郭線色<input class="colorpicker" id="outlineColor"  onchange="globalParam.outlineColor=this.value"/><br />
立体度<input class="slider" id="Stereo" max="2" onchange="globalParam.stereoscope=parseFloat(this.value)"/><br />
<label><input type="radio" id="notstereo" name="q1" value="0" onchange="globalParam.stereomode=parseFloat(this.value)"> 非立体視</label>
<label><input type="radio" id="cross" name="q1" value="1" onchange="globalParam.stereomode=parseFloat(this.value)"> 交差法</label>
<label><input type="radio" id="parallel" name="q1" value="-1" onchange="globalParam.stereomode=parseFloat(this.value)"> 平行法</label>
</div>
<div style="float:left;">
シーン(衣装)<select id="scene"  onchange="globalParam.scene=parseInt(this.value);Test3d.changeScene();">
</select><br />
<label><input type="checkbox" id="shadow" onchange="globalParam.shadow=(this.checked);"/>影</label><br />
フレネル反射率<input class="slider" id="frenel" onchange="globalParam.frenel=this.value"/><br />

</div>
<div style="float:left;margin:10px;border:solid 1px black;"> 
<label><input type="checkbox" id="chkMaterial" onchange="globalParam.materialMode=(this.checked);"/>カスタムマテリアル</label><br />
拡散色<input class="colorpicker" id="customColor" onchange="globalParam.customColor=this.value"/><br />
反射率<input class="slider" id="customReflection" onchange="globalParam.customReflection=this.value"/><br />
反射色<input class="colorpicker" id="customReflectionColor" onchange="globalParam.customReflectionColor=this.value"/><br />
粗さ<input class="slider" id="customRoughness" onchange="globalParam.customRoughness=this.value"/><br />
テクスチャマップ<select id="customTexture" onchange="globalParam.customTexture=parseInt(this.value);">
<option value="-1">-</option>
</select><br />
ハイトマップ<select id="customHeight" onchange="globalParam.customHeight=parseInt(this.value);">
<option value="-1">-</option>
</select><br />
</div>
</div>
<div style="clear:both;left:0;right:0;margin:0 auto;width:720px;height:720px;">
<script type="text/javascript" src="./test3d.js"> </script>
</div>
</body>
</html>

